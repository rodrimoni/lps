---
title: "Exploring the Video Game Sales with Ratings dataset"
author: "Rodrigo N. M. da Silva"
date: "December 2017"
output:
  pdf_document:
    number_sections: yes
  html_document: default
geometry: margin=1.5in, top=0.5in, bottom=0.5in
---

# Introduction

The video games industry is in constant growing and the companies investment are bigger year after year. Hundreds of games are launched by year and them are evaluated by several media specifically segments.  Metacritic is an important tool that a that aggregates reviews of games. For each product, the scores from each review are averaged (weighted average). So the metacritic score is a valuable reference to measure the quality of the games. In this work we will explore a dataset with a large amount of games with its metacritic score and number of sales. The dataset is available in the following website:

https://www.kaggle.com/rush4ratio/video-game-sales-with-ratings

# Goal

We want to understand the trends in video games area, analyzing its sales around the world and its critic scores. Our objective is uncover the bestsellers considering the metacritic score, sales region and game genre. To achieve this we defined a set of questions which will be answered along this work. We will use RStudio, manipulating well-known verbs of the R programming language, as well as specific libraries of tidyverse metapackage (readr, tidyr, dplyr) to create a report using Literate Programming.

# Questions

1. Are the games with the highest critic score the most sold? 
2. Are they sold equally in NA, EU and JP?
3. Which game genre was most sale by each decade?
4. Is the number of sales of shooter games increasing or decreasing?


# Download the data

Supposing you have the URL for the CSV file, you can read the data using the code below. You can also download it manually and commit it to your repository to avoid an internet connection every time you knit this file. If the URL changes, the second solution might even make your analysis be more portable in time.

```{r}
library(readr);
library(dplyr);
library(magrittr);
URL <- "http://www.opendatapoa.com.br/storage/f/2013-11-06T17%3A26%3A29.293Z/acidentes-2000.csv"
```

```{r}
df <- read_delim(URL, delim=";");
```


# Task

- Semantics of the Data

In this analysis the following variables were used:


  1. NOITE_DIA: Variable of type "chr"  that identifies the period of the day when happened the accident. It assumes three values in the dataset: "DIA" means "Day", "NOITE" means "Night" and "NA" means "No Value".
  
  
  2. FX_HORA: Variable of type "int" that identifies the hour of the day when happend the accident. The value means the hour of the day in brazilian format.
  
  
  3. Obs: There are some inconsistencies in the dataset, for example are some records with the NOITE_DIA = Day and FX_HORA = 23 which is clearly wrong, because 23h (11:00pm) is in the period of night.

- The selected question
  "What is the time of the day with most accidents?"
  
- Question answer

The time of the day with most accidents in 2000 is in period of the day at 15 hours (3:00pm)

First we wanted to see which period of the day with most accidents then we plotted a histogram with the count of accidents by period (day and night). To achieve this we wrote this code below:

```{r}
histogram <- df %>% group_by(NOITE_DIA) %>% filter(NOITE_DIA %in% c("DIA", "NOITE"))
count(histogram)
```

We did a "group_by" NOITE_DIA and then we applied a filter to get only the records that had value "DIA" or "NIGHT", excluding the records with the Value "NA".

See the plot below:

```{r, fig.width=3, fig.height=5}
library(ggplot2)
ggp <- ggplot(histogram,aes(x=NOITE_DIA))
# counts
ggp + geom_bar(fill="lightgreen") + ylab("Number of Accidents") + xlab("Period of the day")
```

In this image we can see that the period with the most accidents is the period of the Day ("DIA"" in the image). In the period of the day in this year happened more than 13000 accidents.

After that we wanted to know the exactly time of the day with most accidents, so we wrote the following code:

```{r}
histogramDia <- df %>% group_by(FX_HORA) %>% summarise(N=n())
```

We did a "group_by" FX_HORA (hour) to verify the exactly hour with most accidents. The result is 18h (6pm). We can see better in the histogram plotted below:

```{r, fig.width=15, fig.height=8}
sequence <- 0:23
result <- paste(sequence,"h")
ggp2 <- ggplot(histogramDia,aes(x=factor(FX_HORA, levels= as.character(seq(0,23,1)), labels = result), y=N)) + theme(axis.text.x = element_text(face="bold", size=14))
               
# counts
ggp2 + geom_bar(fill="lightblue", stat = "identity") + xlab("Time of the Day") + ylab("Number of accidents") + geom_text(aes(label=N), vjust=1.6, color="black", size=5.5)
```

In this image we can clearly see that the hour with most accidents is the 18h and in the second place the 15h. 

# Revised Plots 

```{r, fig.width=14, fig.height=6}
sequence <- 0:23
result <- paste(sequence,"h")
ggp2 <- ggplot(histogramDia,aes(x=factor(FX_HORA, levels= as.character(seq(0,23,1)), labels = result), y=N))
               
# counts
ggp2 + geom_bar(fill="darkred", stat = "identity") + xlab("Time of the Day") + ylab("Number of accidents") + geom_text(aes(label=N), vjust=1.5, color="white", size=5.5) + theme_bw(base_size = 22) + scale_y_continuous(breaks=c(seq(0,1400, 250))) +  
  theme (
        axis.title.x = element_blank()
    )
```

The changes in the new plot:

  1. Use of bw_theme()
  2. The color that fill the bars; 
  3. The number of ticks in the Y axis (in this version we have more ticks);
  4. Removal of the X axis title (less ink);